# Automatically generated on 2021-03-12 UTC from https://codemagic.io/app/604564acbe2f9fb72766d730/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  android-workflow:
    name: Android Build Workflow
    max_build_duration: 60
    environment:
      flutter: v2.0.1
      # xcode: latest
      # cocoapods: default
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmdTOC02ZFU3WWcxMUxBYzdGb25pX1lHRU0tZDd4OENvOWVhZHFsWjVtbVhaM19QOENMVmM2MUVURnVCYmFncHBPMDVlMlVLaFNjQ0NpZDV2cnpaYmJVY29ENktDS2tEVy14M3dfSmdlQ1RzVjEwOFB0cVV0R1JjYnJhLUJ5VUhWQnVYTjg3bVZ4Y2M4eFRnQWhXdWtycjNtQ1VUTlJJWXpEQ2NqV2htc0ptaXg1SzNjRjVsUFN0bFFUZEtZYXctNnI3THhNSUxwS1J2SzY2VERUSVQtaXNLaUl4a0pOLWtDdTZBU1NXbHNDZmFmZmVYRXl4NnFCQWQ5UmQ3MTRyYXVHemZzZ2N4c0xncGtPQ0I0Zm1iaFhMWUVSUGVOMGNIUHlGZFJqX3Jzc1laTWxyazIxeTlLVFp3cEN5OHpzM0tmQ0VUTmp2RU5Tc0dTMlNxUnFuSTJ3b3NLMTlNTTdXX1BvYVlTanN1b1hXWmV1dkVLTF9hRjBfMTlZTkFWVGlNUlZmcDdyS3ZmTGZSdV9wVXJ3Ml85N2dlUWxQb1RnM1VXVVJvLUJYWHYydVpHT3QyMExXdjNkVTBrdXRiU0M1bHMwSnhNZG43RkpaZXVFbnNwTC1ZdVpELXZxMndSbzlBd01ickYxLTFibktjcUhIazR2WDRpRjYybS16bVVIQ3pyeTZRdlJSaUVYWnFCYWhoNDFDcnFybHVaZ0gzTW5EeUxUaVloTDg3aXVVOGRqVEQxb2Z2ZEkwck5JS3JwSHpzeUlwNkszRzQ1eDd4ZWdCbXZuZHFpOVo2eTVVdENNUUYwbjVXMlVlczltTnpiYy1hb1dKSzZKdW9VNXNqQjZPTjcxMzhjZXpyUDhvRDlpa3o5LWNVQzhvdzBsVmlBaVBfQTQ5cmZWOWlnM2pTdmtaNzY1aDJ4OHU2OUt0YllTSDIyajZBQzNSbUc2MlpGRnRNNTB4NXlBQkNBWjY1OEliakt2eUd6QUZKZnpJeG8ydmkyX2R4SnBGbjNUV1pBLWV1VGRUcmRYNE1PS09HbGZBRU10bjhPeUVqb19XdDNIa2FHSzdHcU9EX0JwNjN6YkdrNGsxWFlPUmQyQk55ajcta2poelFibGF4NzFoXzY3ZEFUMFQwTlc1UVQ1WlN5S19UOHQ0VkwxSFdxT1U5cVhlTmxSeUhWZ0xLdTJPZEJvNng2bW5mME5ncWhJYm0wb0VTQmNVeXQyOFJMVkx4M1loZWtldEJFVUhDVUVRY0FYcVVVS2RaUm9tWm0tVTYteExBX2I5SGU5WHJuc1FpWFVSTVhKTHpWajhpQ2VQYlpuR3ZhVkZYVmJZSXo5dy1kaUlCalJrRklhMUQ0OFJPaUdYTXF3d3lNWTVQTG5HN3NKZ1c0a1RNQTVxR1hScFJxZVlPMTJkTTFCM1pNb01wb3BqTktuQjF5eUpDM3dVbWFWbzZFZUR2Y1J4R3ZUd3NFR0d6UnU4MGR5VEtfSF9NLURHU2FJQlQwOWF6RWQwOUd4VTVjVjJFT1BxS05MTm9TVzJoVFFSODd5cnU2OElVN1R3dHZsWURjVHRoN0NXV1ZGRS1aa2dqTjRialNxZkJaLVJBOTFoaEhORTduQjlvZjV6blBrZ1c3UDRXQklsLVVVMzFyOHJQZVRBVkZaWmRSSXRjUkJzcTAzdjd0WXJFa3lpQjhQOVVJcVZuV3J2Ml9FU2NPakJpdkFPaFdRRndqM05IV1ZmaF9PX0hHSlRPY0VVYmEtU3FWRWdRMDViQnlQSUkydFJBeDlTY19JdzItQkZNQTQ0V1FqYm9qQmtwdk1JRzhlUE5mUlVkOUVOekF1QzBrWlV1VzR3eHd0aDFZQzgtVUZUMEJRNVZpMEQwNzRBM2N4UVZCVTRGZ0Y1TGNyTkZaMm1nclFqdXFFakowcjdLNDEyOTdacDFEakZ2blNsdVEwOGlpUlJ0X25DNGJWOHp5V2s3X1FQZEtrX0FKdS1pdG5WdFpmcGlhZzN5M215ckVfQko0c1JBU0loQnVMT2tfZXFBTG9hblIzaTBXR0tZWG1XZGZseEtXZDlHaTlGQkxXb3dOVFlyalhiYmR6eGJwcUROV0thdlZoeGEwUmcybDZfV3lTXzFheThjT1Q2RnltMVR5aGxtVW10YWFMUHMzS0NkbUlxM1JOejVrSzc3cW1ja3g5cjUwc1NKWmstSExUWEY1MC1WaXBYYm5ZSWktb1Z6WWl6YTZwNEgtUnFqdXhKMzR4b3YxSTlkc0l0WUNJall4VmVnUnAyWnQ0eWVRZTBWeTNTaW1ISm1kVGRSOFltTmVGRXR2QzZRaDR5UEhqbURtcVhYUm1RNERSbVE5eHltMzVfQ01vNHlORWlzbXh3SVdRUG1mSmJsZ3VyZjNEVHl5bHdyTklOWmJQeG1WanBvaGpFVjlOUmNlUXcxbzdvUGZ1TmJFVnNkWGhZN2J1QXZqVUNkVU45WkF1bk1meUhtdVUxZUhVQ3NDN3Noakw3ZzBTOHYtdl9XQ3dVelZjMWdfbXhmVVBocFIxSEJUcEVpbmkwY0RiOU5NUlFjczFGUERwUzZQd2sxQmlldF9kX29Nc3c1TDhqZDY2Qm8zZzRuWDlGakx3MUc2cEt6WVlvMGp1YlVRclRQSkgwem9HeHRkNncxaDlVV19oNGh6UEJVa2FwRjBXMXZkTDVLaWdYQThxZ1BEYlpfdHNHSzcyYjBrYk1wZElUM3RfQU1CRm4xQkpWNTdkUHFTNzM2NW1leHluMkRaZkVYRW5WUTFsVmRBV29IcTZvMVVwS1I1cDg4OFZEY1gtTjI0OWl5Q0p6emFfSk9JRHRwdjk5bHVHa2FCQUFuSTMxVWRXNDlab0lVQ0tOZWRWUkljY0EwaEdib0ltWlBsRlZreko3MzB5OEk5NEhIaUhSMExsa3pHbmV5Rk5wUkt3dURvRUFibjg1MUdyd2VBTEhHd0NHS05TUUtITFQweTFyMEVRWnFlLVZMc21xbGowNVpKQkYtLThhbzR5Yzg2V1JDdGdKZHd6ME12RVBHVFEycDVQeGtEV0d1UjBFMVlQNlBSc0NaMndwWXJxV2preTIyb29OdmRxcG9TSVZkSWJxX010bnpzaGFRc291dTJiT3FUenVBd25aT09GMDVFT21oUVlPdjhJVjRka1VXcXpiUGZEUFhQN3lIMmNGZnVBR1FJNEdZZ1MzZENKOUM5TjllR1lnUllRQ18zSDhBTWdYR2ZKWnQtUmFTSUtGdW9jS29SV1M3WlNQbUhKd3JQeHIzMkpBX0NWQmpPd2o1UU5mdUVSaU1nQi00QzM1YVV4ZEdoZ2NpNWJSR3p0VFlUQjdxc2tQN0xtY0pCZDhXTlZqVnRXeWhGblNzTFdIc2wxcjc4WWx5UUxqSG1aVmtaWndkWXJVTUJXUmdUa2ItSk9PTzdGOEJEbWRMRzF1UERVQWN2N2c4bzduRVhhLThMN2JmV2VaUUhCNVl5UUFlRUtBdGtQcUtuODZ0OG1LbzltWTNFbTNJMzdPdUN5QmpIb2FwM0lrbU9jZlVDazJ0aHVFY1NVSGstTDVha1pDWmZPMXdaR3FfWC1IVXdFUzlwOXNKRGdZbXFuVVhQY3VIU25ZQ2FiMFBSSC0xdlI5RDVBd3N2Zi00cHJOcWswUFY2RzFZWkc5emlaWTk3LVBwZE9CU25CelBfTU5xMzl1Y0RYZG5nQnNxQkd6a25uYkhHTGNpemZXTXQwaEFRWlNqamtvYzJ0T01BOWs2OVhBSmVvZWVfb1AyQXpaMjVQM193TXJELUtzb3Q5Q1cxNkJTbXUtMFBwdEhaSGRNWi1GWnRvZGc3ZFpKZ2JfNEpjZm55eXdGUHAwcFBZczFFNFpxb1ZCTTRfN2tmNjdFTzlNcU10SjhFWXA3MEFJZ1BwOVRSMjhueUNlUUdlcXI3ZHNwazduY0laSHJlbTdXbHpNWWY0X2tJVUNtX1diZXc5WUNtSmE1aTN4MmRsb2drS2NnazI3OWxOQ181YVZRSWtUa3pBdDMxMWY2NDNMeTNGeG9ZM05jcmQyZ3R6eGU4Sk5ubkVWdmJZR3B3RFczTEQzaHJZY0xhZURKQ2xlTEdPaGV5Z1JCUEpka01VNzQ4U2xUbl9COGp3b0xLdXRScFd1eHFlcDVYQm9hNUNJNHd0TFlPejV0NFlZN204a3ZtdXo5MzNTOEN6TldKNEhIREZXM01IRzBKc0wtX1M5ckVjYWhnOTVVTUlBMFBpRm51N09hcjZuYWduclVqbEh0MW1MVWl1c2xyZVBXT0p6RlJfak5EU1ExeW9vaGRrcE1jNTI2ZllRU0p0RDd0dGpVNFNqUzBOejlCWk02Y2FZTU9GNGlxeVBwbmV0N0VWU1V0LUFKYzlyNUFkbTJuaUdOLTVkblNuRzhxT0hWUmZHajhKXy1kR2FKamlJcHBLWW5NamJpTjV5RjF3VXQ0UGdOeHdIdU9EUm1YN3U5Y280WE8tY3pCRG12WThHMzBnenlOY0poZ1VNSkdLUDhQb3BwZmM3UWZ5cndrb1FoOUJmd2N5VnpYU0dnZlRSNGtQRWprSjBKOWIyT3hQMXhuYjNDdm9iM2xOdE4yUTZ6R0ZOT0dkam9UQVhYQktFWFRncENmVUZSakxlZ2dGMTdXRzk5aWZ1X0cwa0FTYXNjZUQyZDZ3MXhoVlZhSWVVTFhtaWIzX094TGlyUjVYdlctUWR2RDRCazgyUnRpUkdhVnYwUjNkRUdrZnB0UmpSaTRTb2J4al9FRHdIbVpqNEJsUHJRWEp4bVdlNV85aEJ0RjVyMWZpUzJkVncxNjhDVFRPX1NOaE9YRnhVdVNpWUd3ZnhyMVhUbEhFNnF4Y0p6UU1DWnRvQmhkYUw1bHRyZzZhMXZOdmg4S2JDVnBMVjFwSWJNbUZpbVZUeUk2Q29ob1JKZWRJaGVnNkdjeG5vankwcXFLeFZzVlhReGMzVDhuaWpKWVU3M2FvTUZ0eU9keGp4OC03NXNoRXNaRnZPSGFqN3BBOVZPaGtScG83MG50RWY5aS00UG40UDNJcnpDeThZQUliVVc0cWUwWDJnbXdpeWNSOEFOelFncnVkb0R5c3lCMTVxbk5hWVpRNFBYeXBGWFZhRzctYUZObUVlVnVSMHJ4emlxWHhOMGh3MGhoaUZ4RnJCUXJsZjRGTFpENTl6cFBZNFhaNWlfSVRKN3RNX19tZ3MzRG1mMDRmUlk2M2JKNU9RRzNuaVZUbmFJNUFhVWQyZWsyakgzVmVlcFJfdkVkVXhabmV2STBkYXNJMFhMM24yQXdFTGhmM0JsaUV2ckV5LVQ0U3FPQ1Byc3dVSEhBbkJxV2ZJY2IxTHUzZWtIWkRtSkZkWmZITDBxdWViRVpP)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdTOF9lVEphV1BIc294SXYzZGhzMmNoQ01aX0Jlb1duMnlka3AwM3dydnluMldPM2xNTXpEZDlDc19rbTgtU1lDMW16aWtLVFNVRkZnTnUzSndhMHU1a1FqTWc9PQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmdTOF9lVEphV1BIc294SXYzZGhzMmNoQ01aX0Jlb1duMnlka3AwM3dydnluMldPM2xNTXpEZDlDc19rbTgtU1lDMW16aWtLVFNVRkZnTnUzSndhMHU1a1FqTWc9PQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmdTOF8xdmltNGVPdWF3WGotUmxqNjJfMU1EdTY0eWJVT0tXUjdVajNHVlZjMmlvRHc1NFYzSmJUTF9OZEJ2aVhobVAycE8zR1UtUEFUSXNmM3lMcTZ4Wm1iTnc9PQ==)
    triggering:
      events:
        - tag
      branch_patterns:
        - pattern: '*'
          include: true
          source: true
    scripts:
      - name: Set up key.properties
        script: |
          echo $FCI_KEYSTORE | base64 --decode > "$FCI_KEYSTORE_PATH"
          cat > "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_PASSWORD
          keyAlias=$FCI_KEY_ALIAS
          storeFile=$FCI_KEYSTORE_PATH
          EOF
      - name: Set up local.properties
        script: echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"

      # Build binaries
      - cd "$FCI_BUILD_DIR" && flutter packages pub get
      - cd "$FCI_BUILD_DIR" && flutter build apk --release --split-per-abi
      - cd "$FCI_BUILD_DIR" && flutter build apk --release --target-platform=android-arm64,android-arm

      - name: Generate sha256sum per-file
        script: |
          mkdir sha256_sums
          for file in app-{,arm64-v8a-,armeabi-v7a-,x86_64-}release.apk; do
            openssl dgst -sha256 "${FCI_BUILD_DIR}/build/app/outputs/flutter-apk/${file}"| sed -E 's/.+ ([0-9a-f]+)/\1/' > "${FCI_BUILD_DIR}/sha256_sums/sha256-${file}.txt"
          done
    artifacts:
      - build/app/outputs/flutter-apk/app-release.apk
      - build/app/outputs/flutter-apk/app-arm64-v8a-release.apk
      - build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk
      - build/app/outputs/flutter-apk/app-x86_64-release.apk
      - sha256_sums/sha256-app-release.apk.txt
      - sha256_sums/sha256-app-arm64-v8a-release.apk.txt
      - sha256_sums/sha256-app-armeabi-v7a-release.apk.txt
      - sha256_sums/sha256-app-x86_64-release.apk.txt
    publishing:
      github_releases:

